<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width" name="viewport"/>
<link href="/8bitcc.ico" rel="icon" type="image/png"/>
<meta content="website" name="og:type"/>
<title>One-Shot-S3-Cleanup</title>
<meta content="One-Shot-S3-Cleanup" name="twitter:title"/>
<meta content="One-Shot-S3-Cleanup" name="og:title"/>
<meta content="So I made a mistake in an app I am working on and ended up creating thumbnails I got the idea of the one shot app from  Here is the result of the s3 Here is the" name="description"/>
<meta content="So I made a mistake in an app I am working on and ended up creating thumbnails I got the idea of the one shot app from  Here is the result of the s3 Here is the" name="og:description"/>
<meta content="So I made a mistake in an app I am working on and ended up creating thumbnails I got the idea of the one shot app from  Here is the result of the s3 Here is the" name="twitter:description"/>
<meta content="article" name="og:type"/>
<meta content="https://waylonwalker.com/one-shot-s3-cleanup" name="og:url"/>
<meta content="http://shots.wayl.one/shot/?url=https://waylonwalker.com/one-shot-s3-cleanup&amp;height=600&amp;width=1200&amp;scaled_width=1200&amp;scaled_height=600" name="og:image"/>
<meta content="http://shots.wayl.one/shot/?url=https://waylonwalker.com/one-shot-s3-cleanup&amp;height=640&amp;width=1280&amp;scaled_width=1280&amp;scaled_height=640" name="twitter:image"/>
<meta content="1200" name="og:image:width"/>
<meta content="600" name="og:image:height"/>
<meta content="@_waylonwalker" name="twitter:creator"/>
<meta content="summary_large_image" name="twitter:card"/>
<meta content="Waylon Walker" name="og:author"/>
<meta content="Waylon Walker" name="og:site_name"/>
<meta content="waylon@waylonwalker.com" name="og:author_email"/>
<meta content="markata 0.8.1.dev12" name="generator"/>
<meta content="$ilp.uphold.com/MGN2ni2YMXaQ" name="monetization"/>
<meta content="#322D39" name="theme-color"/>
<link href="/app-39.css" rel="stylesheet"/>
<link href="https://waylonwalker.com/one-shot-s3-cleanup/" rel="canonical"/>
<link href="https://waylonwalker.com/one-shot-s3-cleanup/amp/" rel="amphtml"/>
<link href="https://indieauth.com/auth" rel="authorization_endpoint"/>
<link href="https://tokens.indieauth.com/token" rel="token_endpoint"/>
<link href="https://waylonwalker.com/one-shot-s3-cleanup/amp" rel="amphtml"/>
<link href="https://waylonwalker.com/archive" rel="micropub"/>
<link href="https://webmention.io/waylonwalker.com/webmention" rel="webmention"/>
<link href="https://images.waylonwalker.com" rel="preconnect"/>
<link href="https://covers.waylonwalker.com" rel="preconnect"/>
<link href="https://stable-diffusion.waylonwalker.com" rel="preconnect"/>
<link href="https://screenshots.waylonwalker.com" rel="preconnect"/>
<link href="/8bitcc_48x48.png" rel="apple-touch-icon"/>
<link href="/8bitcc_72x72.png" rel="apple-touch-icon"/>
<link href="/8bitcc_96x96.png" rel="apple-touch-icon"/>
<link href="/8bitcc_144x144.png" rel="apple-touch-icon"/>
<link href="/8bitcc_192x192.png" rel="apple-touch-icon"/>
<link href="/8bitcc_256x256.png" rel="apple-touch-icon"/>
<link href="/8bitcc_384x384.png" rel="apple-touch-icon"/>
<link href="/8bitcc_512x512.png" rel="apple-touch-icon"/>
<script src="/htmx.min.js"></script> <script>
        navigator.serviceWorker.getRegistrations().then(function (registrations) {
            for (let registration of registrations) {
                registration.unregister();
            }
        });

    </script>
<script type="application/ld+json">
            {
                "@context": "https://schema.org/",
                "@type": "WebPage",
                "name": "One-Shot-S3-Cleanup",
                "headline": "One-Shot-S3-Cleanup",
                "datePublished": "2025-01-12",
                "dateModified": "2025-01-12",
                "author": {
                    "@type": "Person",
                    "name": "Waylon Walker"
                    "url": "https://waylonwalker.com"
                },
                "image": [
                    "https://shots.wayl.one/shot/?url=https://waylonwalker.com/&height=640&width=1280&scaled_width=1280&scaled_height=640",
                ]
                "speakable":
                {
                    "@type": "SpeakableSpecification",
                    "cssSelector": [
                        "#title",
                        "#post-body"
                    ]
                },
                "url": "https://waylonwalker.com/"
            }
        </script>
</head>
<body position="relative">
<div class="neon-ring"></div>
<div class="dubs">
<nav class="w-full bg-gray-950 py-4 mb-8 sticky border-b border-pink-500">
<ul>
<li><a href="/" hx-boost="true">Home</a></li>
<li><a href="/start/" hx-boost="true">Start Here</a></li>
<li><a href="/archive/" hx-boost="true">Archive</a></li>
<li><a href="/about/" hx-boost="true">About</a></li>
<li><a href="/feeds/" hx-boost="true">RSS</a></li>
</ul>
</nav> <div>
<article class="blog-post h-entry">
<div id="title-wrapper">
<a class="no-underline u-url" href="https://waylonwalker.com//" hx-boost="true">
<h1 class="flair blog title no-link" id="title">
            One-Shot-S3-Cleanup
        </h1>
</a>
<p class="m-0 sm:m-[-2rem]">
<time class="dt-published post-date" datetime="" style="text-align: right; z-index: 2"></time>
</p>
<div class="flex flex-row h-card p-author space-between" rel="author">
<img alt="pixelated avatar of Waylon Walker with a yellow and pink background" class="m-auto ml-0 w-16 h-16 rounded-full u-photo shadow-[0_0_5px_5px_rgba(0,0,0,0.4)]" src="/88-8bitcc.webp"/>
<div class="content">
<a class="p-name u-url h-card p-author" href="https://waylonwalker.com/" hx-boost="true" rel="me">
<p>
<span class="p-given-name">Waylon</span>
<span class="p-family-name">Walker</span>
</p>
</a>
<p class="p-note">
                Learning in Public
                <a href="https://twitter.com/_WaylonWalker" rel="me">@_WaylonWalker</a>
</p>
</div>
</div>
<!-- edit -->
<!-- <p> -->
<!--     <a href="https://github.com/WaylonWalker/waylonwalker.com/edit/main/pages/blog/.md" -->
<!--         alt="edit post url" title="edit this post">edit<span role="img" aria-label="">✏️</span></a> -->
<!-- </p> -->
</div><h2 class="m-auto max-w-md text-sm text-center text-gray-200 no-link">Tags</h2>
<ul class="flex flex-wrap justify-center p-0 m-auto max-w-md border-yellow-400 tags">
<li class="px-4 mx-2 list-none rounded-full ring-1 ring-pink-500">
<a class="p-category" href="https://waylonwalker.com/python" hx-boost="true">python</a>
</li>
<li class="px-4 mx-2 list-none rounded-full ring-1 ring-pink-500">
<a class="p-category" href="https://waylonwalker.com/python" hx-boost="true">python</a>
</li>
<li class="px-4 mx-2 list-none rounded-full ring-1 ring-pink-500">
<a class="p-category" href="https://waylonwalker.com/python" hx-boost="true">python</a>
</li>
</ul> <div class="e-content" data-pagefind-body="" id="post-body">
<p>So I made a mistake in an app I am working on and ended up creating thumbnails
of thumbnails, and thumbnails of thumbnails of thumbnails... etc. I was able to
delete them all, but I wanted to make a one-shot script to do it.</p>
<h2 id="one-shot-app">One Shot App <a aria-label="Permalink to Heading One Shot App " class="header-anchor" href="#one-shot-app" hx-boost="true"><svg aria-hidden="true" class="heading-permalink" fill="currentColor" focusable="false" height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2>
<p>I got the idea of the one shot app from <a href="https://simonwillison.net/2024/Dec/19/one-shot-python-tools/">Simon
Willison</a> and
replicated his setup in a chatgpt project</p>
<p><img alt="screenshot-2025-01-12T18-16-57-443Z.png" src="https://dropper.wayl.one/api/file/78d6eea9-29a2-43ed-b09e-1585762c991c.webp"/></p>
<h2 id="initial-prompt">Initial Prompt <a aria-label="Permalink to Heading Initial Prompt " class="header-anchor" href="#initial-prompt" hx-boost="true"><svg aria-hidden="true" class="heading-permalink" fill="currentColor" focusable="false" height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2>
<pre class="wrapper">

<div class="copy-wrapper">

<button class="copy" onclick="navigator.clipboard.writeText(this.parentElement.parentElement.querySelector('pre').textContent)" title="copy code to clipboard"><svg id="Layer_1" style="enable-background:new 0 0 115.77 122.88" version="1.1" viewbox="0 0 115.77 122.88" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"><style type="text/css">.st0{fill-rule:evenodd;clip-rule:evenodd;}</style><g><path class="st0" d="M89.62,13.96v7.73h12.19h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02v0.02 v73.27v0.01h-0.02c-0.01,3.84-1.57,7.33-4.1,9.86c-2.51,2.5-5.98,4.06-9.82,4.07v0.02h-0.02h-61.7H40.1v-0.02 c-3.84-0.01-7.34-1.57-9.86-4.1c-2.5-2.51-4.06-5.98-4.07-9.82h-0.02v-0.02V92.51H13.96h-0.01v-0.02c-3.84-0.01-7.34-1.57-9.86-4.1 c-2.5-2.51-4.06-5.98-4.07-9.82H0v-0.02V13.96v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07V0h0.02h61.7 h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02V13.96L89.62,13.96z M79.04,21.69v-7.73v-0.02h0.02 c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v64.59v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h12.19V35.65 v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07v-0.02h0.02H79.04L79.04,21.69z M105.18,108.92V35.65v-0.02 h0.02c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v73.27v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h61.7h0.02 v0.02c0.91,0,1.75-0.39,2.37-1.01c0.61-0.61,1-1.46,1-2.37h-0.02V108.92L105.18,108.92z"></path></g></svg></button>
</div>
        
<div class="highlight"><pre><span></span>a mistake was made in my s3 bucket and I've created a bunch of extra files
write a script that deletes all files that contain _thumb_thumb

⬢ [devtainer] ❯ aws s3 ls s3://dropper
2024-12-29 14:32:32      16158 02271f4c-be18-4bea-b23e-d00f9fe42b9f.webp
2025-01-11 14:20:49       2878 02271f4c-be18-4bea-b23e-d00f9fe42b9f_thumb.webp
2025-01-11 14:21:17       2858 02271f4c-be18-4bea-b23e-d00f9fe42b9f_thumb_thumb.webp
2025-01-11 14:21:44       2856 02271f4c-be18-4bea-b23e-d00f9fe42b9f_thumb_thumb_thumb.webp
2025-01-11 14:21:44       2856 02271f4c-be18-4bea-b23e-d00f9fe42b9f_thumb_thumb_thumb_thumb.webp
2024-12-27 10:25:36       2812 06422c09-d0da-44ec-9339-786864ebccf2.webp
2025-01-11 14:20:49       2710 06422c09-d0da-44ec-9339-786864ebccf2_thumb.webp
2025-01-11 14:21:17       2652 06422c09-d0da-44ec-9339-786864ebccf2_thumb_thumb.webp
2025-01-11 14:21:45       2632 06422c09-d0da-44ec-9339-786864ebccf2_thumb_thumb_thumb.webp
2025-01-11 14:21:45       2632 06422c09-d0da-44ec-9339-786864ebccf2_thumb_thumb_thumb_thumb.webp
2024-12-29 20:44:14     146060 074edddb-8b46-4d94-9b55-d70a7bb74366.webp
2025-01-11 14:20:50      12476 074edddb-8b46-4d94-9b55-d70a7bb74366_thumb.webp
2025-01-11 14:21:17      12400 074edddb-8b46-4d94-9b55-d70a7bb74366_thumb_thumb.webp

create a typer application to do this job
include a --dry-run flag
make the search for _thumb_thumb editable
</pre></div>

</pre>
<h2 id="s3_cleanup">s3_cleanup <a aria-label="Permalink to Heading s3_cleanup " class="header-anchor" href="#s3_cleanup" hx-boost="true"><svg aria-hidden="true" class="heading-permalink" fill="currentColor" focusable="false" height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2>
<p>Here is the result of the s3_cleanup script.  It ended up being 5 or 6 passes
to get everything I wanted with soft-delete enabled. Nice preview outputs in
the dry run.  This was 90% created by chatgpt 4o, with some slight hand edits
by me along the way.</p>
<pre class="wrapper">

<div class="copy-wrapper">

<button class="copy" onclick="navigator.clipboard.writeText(this.parentElement.parentElement.querySelector('pre').textContent)" title="copy code to clipboard"><svg id="Layer_1" style="enable-background:new 0 0 115.77 122.88" version="1.1" viewbox="0 0 115.77 122.88" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"><style type="text/css">.st0{fill-rule:evenodd;clip-rule:evenodd;}</style><g><path class="st0" d="M89.62,13.96v7.73h12.19h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02v0.02 v73.27v0.01h-0.02c-0.01,3.84-1.57,7.33-4.1,9.86c-2.51,2.5-5.98,4.06-9.82,4.07v0.02h-0.02h-61.7H40.1v-0.02 c-3.84-0.01-7.34-1.57-9.86-4.1c-2.5-2.51-4.06-5.98-4.07-9.82h-0.02v-0.02V92.51H13.96h-0.01v-0.02c-3.84-0.01-7.34-1.57-9.86-4.1 c-2.5-2.51-4.06-5.98-4.07-9.82H0v-0.02V13.96v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07V0h0.02h61.7 h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02V13.96L89.62,13.96z M79.04,21.69v-7.73v-0.02h0.02 c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v64.59v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h12.19V35.65 v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07v-0.02h0.02H79.04L79.04,21.69z M105.18,108.92V35.65v-0.02 h0.02c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v73.27v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h61.7h0.02 v0.02c0.91,0,1.75-0.39,2.37-1.01c0.61-0.61,1-1.46,1-2.37h-0.02V108.92L105.18,108.92z"></path></g></svg></button>
</div>
        
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env -S uv run --quiet --script</span>
<span class="c1"># /// script</span>
<span class="c1"># requires-python = "&gt;=3.12"</span>
<span class="c1"># dependencies = [</span>
<span class="c1">#     "boto3",</span>
<span class="c1">#     "typer",</span>
<span class="c1">#     "rich"</span>
<span class="c1"># ]</span>
<span class="c1"># ///</span>

<span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
<span class="kn">from</span> <span class="nn">rich.console</span> <span class="kn">import</span> <span class="n">Console</span>
<span class="kn">from</span> <span class="nn">rich.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">typer</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Typer</span><span class="p">()</span>
<span class="n">console</span> <span class="o">=</span> <span class="n">Console</span><span class="p">()</span>

<span class="n">DEFAULT_SOFT_DELETE_DIR</span> <span class="o">=</span> <span class="s2">"soft-delete/"</span>


<span class="k">def</span> <span class="nf">human_readable_size</span><span class="p">(</span><span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Convert bytes to a human-readable format."""</span>
    <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"B"</span><span class="p">,</span> <span class="s2">"KB"</span><span class="p">,</span> <span class="s2">"MB"</span><span class="p">,</span> <span class="s2">"GB"</span><span class="p">,</span> <span class="s2">"TB"</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="mi">1024</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">size</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">"</span>
        <span class="n">size</span> <span class="o">/=</span> <span class="mi">1024</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">size</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> PB"</span>


<span class="k">def</span> <span class="nf">calculate_file_age</span><span class="p">(</span><span class="n">last_modified</span><span class="p">:</span> <span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Calculate the age of the file from the current time."""</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">last_modified</span>
    <span class="n">days</span> <span class="o">=</span> <span class="n">age</span><span class="o">.</span><span class="n">days</span>
    <span class="k">if</span> <span class="n">days</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">days</span><span class="si">}</span><span class="s2"> days"</span>
    <span class="n">hours</span><span class="p">,</span> <span class="n">remainder</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">age</span><span class="o">.</span><span class="n">seconds</span><span class="p">,</span> <span class="mi">3600</span><span class="p">)</span>
    <span class="n">minutes</span> <span class="o">=</span> <span class="n">remainder</span> <span class="o">//</span> <span class="mi">60</span>
    <span class="k">if</span> <span class="n">hours</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">hours</span><span class="si">}</span><span class="s2"> hours"</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">minutes</span><span class="si">}</span><span class="s2"> minutes"</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">clean</span><span class="p">(</span>
    <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Argument</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">"The name of the S3 bucket."</span><span class="p">),</span>
    <span class="n">substring</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Argument</span><span class="p">(</span>
        <span class="o">...</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">"The substring to search for in file names."</span>
    <span class="p">),</span>
    <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">"If set, no files will be deleted; only listed."</span>
    <span class="p">),</span>
    <span class="n">soft_delete</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">"If set, files will be moved to a soft delete directory instead of permanently deleted."</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">soft_delete_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="n">DEFAULT_SOFT_DELETE_DIR</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">"The directory to move soft-deleted files to."</span>
    <span class="p">),</span>
    <span class="n">max_age</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">"Maximum age of files to include, in days."</span><span class="p">),</span>
    <span class="n">min_age</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">"Minimum age of files to include, in days."</span><span class="p">),</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""Delete or soft-delete files in an S3 bucket that contain a specific substring in their names."""</span>
    <span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">"s3"</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># List all objects in the bucket</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">list_objects_v2</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">"Contents"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"[bold yellow]No files found in the bucket.[/bold yellow]"</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">file_within_age_range</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="n">file_age</span> <span class="o">=</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">obj</span><span class="p">[</span><span class="s2">"LastModified"</span><span class="p">])</span><span class="o">.</span><span class="n">days</span>
            <span class="k">if</span> <span class="n">max_age</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">file_age</span> <span class="o">&gt;</span> <span class="n">max_age</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">min_age</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">file_age</span> <span class="o">&lt;</span> <span class="n">min_age</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="n">files_to_process</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">obj</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">"Contents"</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">substring</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">[</span><span class="s2">"Key"</span><span class="p">]</span> <span class="ow">and</span> <span class="n">file_within_age_range</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">files_to_process</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                <span class="s2">"[bold yellow]No files matching criteria found in the bucket.[/bold yellow]"</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                <span class="s2">"[bold blue]Dry run mode: The following files would be processed:[/bold blue]"</span>
            <span class="p">)</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Files to be Processed"</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">"File Name"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"cyan"</span><span class="p">,</span> <span class="n">no_wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">"Size"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"magenta"</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">"right"</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">"Age"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"green"</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">"right"</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">"Action"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"yellow"</span><span class="p">,</span> <span class="n">no_wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">total_size</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">files_to_process</span><span class="p">:</span>
                <span class="n">human_size</span> <span class="o">=</span> <span class="n">human_readable_size</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s2">"Size"</span><span class="p">])</span>
                <span class="n">file_age</span> <span class="o">=</span> <span class="n">calculate_file_age</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s2">"LastModified"</span><span class="p">])</span>
                <span class="n">action</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"[bold yellow]-&gt; </span><span class="si">{</span><span class="n">soft_delete_dir</span><span class="si">}{</span><span class="n">obj</span><span class="p">[</span><span class="s1">'Key'</span><span class="p">]</span><span class="si">}</span><span class="s2">[/bold yellow]"</span>
                    <span class="k">if</span> <span class="n">soft_delete</span>
                    <span class="k">else</span> <span class="s2">"[bold red]DELETE[/bold red]"</span>
                <span class="p">)</span>
                <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s2">"Key"</span><span class="p">],</span> <span class="n">human_size</span><span class="p">,</span> <span class="n">file_age</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
                <span class="n">total_size</span> <span class="o">+=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">"Size"</span><span class="p">]</span>

            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">[bold green]Summary:[/bold green] </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files_to_process</span><span class="p">)</span><span class="si">}</span><span class="s2"> files, Total Size: </span><span class="si">{</span><span class="n">human_readable_size</span><span class="p">(</span><span class="n">total_size</span><span class="p">)</span><span class="si">}</span><span class="s2">, Operation: </span><span class="si">{</span><span class="s1">'Soft Delete'</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">soft_delete</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">'Delete'</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">files_to_process</span><span class="p">:</span>
                <span class="n">file_key</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">"Key"</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">soft_delete</span><span class="p">:</span>
                    <span class="n">copy_source</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Bucket"</span><span class="p">:</span> <span class="n">bucket_name</span><span class="p">,</span> <span class="s2">"Key"</span><span class="p">:</span> <span class="n">file_key</span><span class="p">}</span>
                    <span class="n">new_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">soft_delete_dir</span><span class="si">}{</span><span class="n">file_key</span><span class="si">}</span><span class="s2">"</span>
                    <span class="n">s3</span><span class="o">.</span><span class="n">copy_object</span><span class="p">(</span>
                        <span class="n">CopySource</span><span class="o">=</span><span class="n">copy_source</span><span class="p">,</span> <span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">new_key</span>
                    <span class="p">)</span>
                    <span class="n">s3</span><span class="o">.</span><span class="n">delete_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">file_key</span><span class="p">)</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"[bold yellow]Moved to soft-delete:[/bold yellow] </span><span class="si">{</span><span class="n">file_key</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">new_key</span><span class="si">}</span><span class="s2">"</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">s3</span><span class="o">.</span><span class="n">delete_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">file_key</span><span class="p">)</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[bold red]Deleted:[/bold red] </span><span class="si">{</span><span class="n">file_key</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"[bold green]Operation completed. </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files_to_process</span><span class="p">)</span><span class="si">}</span><span class="s2"> files processed. Operation: </span><span class="si">{</span><span class="s1">'Soft Delete'</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">soft_delete</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">'Delete'</span><span class="si">}</span><span class="s2">[/bold green]"</span>
            <span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[bold red]Error:[/bold red] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">clear_soft_delete</span><span class="p">(</span>
    <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Argument</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">"The name of the S3 bucket."</span><span class="p">),</span>
    <span class="n">soft_delete_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="n">DEFAULT_SOFT_DELETE_DIR</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">"The soft delete directory to clear."</span>
    <span class="p">),</span>
    <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">"If set, no files will be deleted; only listed."</span>
    <span class="p">),</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""Remove all files in the soft delete directory."""</span>
    <span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">"s3"</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">list_objects_v2</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">Prefix</span><span class="o">=</span><span class="n">soft_delete_dir</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">"Contents"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"[bold yellow]No files found in the soft delete directory '</span><span class="si">{</span><span class="n">soft_delete_dir</span><span class="si">}</span><span class="s2">'.[/bold yellow]"</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="n">files_to_delete</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">"Contents"</span><span class="p">]]</span>

        <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                <span class="s2">"[bold blue]Dry run mode: The following files would be deleted from the soft delete directory:[/bold blue]"</span>
            <span class="p">)</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Files to be Deleted"</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">"File Name"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"cyan"</span><span class="p">,</span> <span class="n">no_wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">"Size"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"magenta"</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">"right"</span><span class="p">)</span>
            <span class="n">total_size</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">files_to_delete</span><span class="p">:</span>
                <span class="n">human_size</span> <span class="o">=</span> <span class="n">human_readable_size</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s2">"Size"</span><span class="p">])</span>
                <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s2">"Key"</span><span class="p">],</span> <span class="n">human_size</span><span class="p">)</span>
                <span class="n">total_size</span> <span class="o">+=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">"Size"</span><span class="p">]</span>

            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">[bold green]Summary:[/bold green] </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files_to_delete</span><span class="p">)</span><span class="si">}</span><span class="s2"> files, Total Size: </span><span class="si">{</span><span class="n">human_readable_size</span><span class="p">(</span><span class="n">total_size</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">file_key</span> <span class="ow">in</span> <span class="n">files_to_delete</span><span class="p">:</span>
                <span class="n">file_key</span> <span class="o">=</span> <span class="n">file_key</span><span class="p">[</span><span class="s2">"Key"</span><span class="p">]</span>
                <span class="n">s3</span><span class="o">.</span><span class="n">delete_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">file_key</span><span class="p">)</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"[bold red]Deleted from soft-delete:[/bold red] </span><span class="si">{</span><span class="n">file_key</span><span class="si">}</span><span class="s2">"</span>
                <span class="p">)</span>

            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"[bold green]Soft delete directory '</span><span class="si">{</span><span class="n">soft_delete_dir</span><span class="si">}</span><span class="s2">' cleared. </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files_to_delete</span><span class="p">)</span><span class="si">}</span><span class="s2"> files removed.[/bold green]"</span>
            <span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[bold red]Error:[/bold red] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"[bold red]Operation failed.[/bold red]"</span><span class="p">)</span>

        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">undo_soft_delete</span><span class="p">(</span>
    <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Argument</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">"The name of the S3 bucket."</span><span class="p">),</span>
    <span class="n">soft_delete_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="n">DEFAULT_SOFT_DELETE_DIR</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">"The soft delete directory to restore from."</span>
    <span class="p">),</span>
    <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span>
        <span class="kc">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">"If set, no files will be restored; only listed."</span>
    <span class="p">),</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""Restore all files from the soft delete directory to their original locations."""</span>
    <span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">"s3"</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">list_objects_v2</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">Prefix</span><span class="o">=</span><span class="n">soft_delete_dir</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">"Contents"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"[bold yellow]No files found in the soft delete directory '</span><span class="si">{</span><span class="n">soft_delete_dir</span><span class="si">}</span><span class="s2">'.[/bold yellow]"</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="n">files_to_restore</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">"Contents"</span><span class="p">]]</span>

        <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                <span class="s2">"[bold blue]Dry run mode: The following files would be restored:[/bold blue]"</span>
            <span class="p">)</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Files to be Restored"</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">"File Name"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"cyan"</span><span class="p">,</span> <span class="n">no_wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">"Size"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"magenta"</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">"right"</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">"Original Location"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"green"</span><span class="p">,</span> <span class="n">no_wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">total_size</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">files_to_restore</span><span class="p">:</span>
                <span class="n">human_size</span> <span class="o">=</span> <span class="n">human_readable_size</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s2">"Size"</span><span class="p">])</span>
                <span class="n">original_key</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">"Key"</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">soft_delete_dir</span><span class="p">)</span> <span class="p">:]</span>
                <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s2">"Key"</span><span class="p">],</span> <span class="n">human_size</span><span class="p">,</span> <span class="n">original_key</span><span class="p">)</span>
                <span class="n">total_size</span> <span class="o">+=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">"Size"</span><span class="p">]</span>

            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">[bold green]Summary:[/bold green] </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files_to_restore</span><span class="p">)</span><span class="si">}</span><span class="s2"> files, Total Size: </span><span class="si">{</span><span class="n">human_readable_size</span><span class="p">(</span><span class="n">total_size</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">files_to_restore</span><span class="p">:</span>
                <span class="n">file_key</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">"Key"</span><span class="p">]</span>
                <span class="n">original_key</span> <span class="o">=</span> <span class="n">file_key</span><span class="p">[</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">soft_delete_dir</span><span class="p">)</span> <span class="p">:</span>
                <span class="p">]</span>  <span class="c1"># Remove the soft delete prefix</span>
                <span class="n">copy_source</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Bucket"</span><span class="p">:</span> <span class="n">bucket_name</span><span class="p">,</span> <span class="s2">"Key"</span><span class="p">:</span> <span class="n">file_key</span><span class="p">}</span>
                <span class="n">s3</span><span class="o">.</span><span class="n">copy_object</span><span class="p">(</span>
                    <span class="n">CopySource</span><span class="o">=</span><span class="n">copy_source</span><span class="p">,</span> <span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">original_key</span>
                <span class="p">)</span>
                <span class="n">s3</span><span class="o">.</span><span class="n">delete_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">file_key</span><span class="p">)</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"[bold green]Restored:[/bold green] </span><span class="si">{</span><span class="n">file_key</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">original_key</span><span class="si">}</span><span class="s2">"</span>
                <span class="p">)</span>

            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"[bold green]Restoration completed. </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files_to_restore</span><span class="p">)</span><span class="si">}</span><span class="s2"> files restored.[/bold green]"</span>
            <span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[bold red]Error:[/bold red] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">app</span><span class="p">()</span>
</pre></div>

</pre>
<h2 id="full-help-text-output">full help text output <a aria-label="Permalink to Heading full help text output " class="header-anchor" href="#full-help-text-output" hx-boost="true"><svg aria-hidden="true" class="heading-permalink" fill="currentColor" focusable="false" height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2>
<p>Here is the help text for all of the commands in the script.</p>
<pre class="wrapper">

<div class="copy-wrapper">

<button class="copy" onclick="navigator.clipboard.writeText(this.parentElement.parentElement.querySelector('pre').textContent)" title="copy code to clipboard"><svg id="Layer_1" style="enable-background:new 0 0 115.77 122.88" version="1.1" viewbox="0 0 115.77 122.88" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"><style type="text/css">.st0{fill-rule:evenodd;clip-rule:evenodd;}</style><g><path class="st0" d="M89.62,13.96v7.73h12.19h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02v0.02 v73.27v0.01h-0.02c-0.01,3.84-1.57,7.33-4.1,9.86c-2.51,2.5-5.98,4.06-9.82,4.07v0.02h-0.02h-61.7H40.1v-0.02 c-3.84-0.01-7.34-1.57-9.86-4.1c-2.5-2.51-4.06-5.98-4.07-9.82h-0.02v-0.02V92.51H13.96h-0.01v-0.02c-3.84-0.01-7.34-1.57-9.86-4.1 c-2.5-2.51-4.06-5.98-4.07-9.82H0v-0.02V13.96v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07V0h0.02h61.7 h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02V13.96L89.62,13.96z M79.04,21.69v-7.73v-0.02h0.02 c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v64.59v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h12.19V35.65 v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07v-0.02h0.02H79.04L79.04,21.69z M105.18,108.92V35.65v-0.02 h0.02c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v73.27v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h61.7h0.02 v0.02c0.91,0,1.75-0.39,2.37-1.01c0.61-0.61,1-1.46,1-2.37h-0.02V108.92L105.18,108.92z"></path></g></svg></button>
</div>
        
<div class="highlight"><pre><span></span>dropper<span class="w"> </span>on<span class="w"> </span><span class="w"> </span>main<span class="w"> </span><span class="o">[</span>!?<span class="o">]</span><span class="w"> </span>is<span class="w"> </span>📦<span class="w"> </span>v1.0.0<span class="w"> </span>via<span class="w"> </span><span class="w"> </span>v22.13.0<span class="w"> </span><span class="w"> </span>v3.11.10<span class="w"> </span>on<span class="w"> </span><span class="w"> </span><span class="o">(</span>us-east-1<span class="o">)</span><span class="w">  </span>NO<span class="w"> </span>PYTHON<span class="w"> </span>VENV<span class="w"> </span>SET<span class="w"> </span>took<span class="w"> </span>7s
⬢<span class="w"> </span><span class="o">[</span>devtainer<span class="o">]</span><span class="w"> </span>❯<span class="w"> </span>./scripts/s3_cleanup.py<span class="w"> </span>--help

<span class="w"> </span>Usage:<span class="w"> </span>s3_cleanup.py<span class="w"> </span><span class="o">[</span>OPTIONS<span class="o">]</span><span class="w"> </span>COMMAND<span class="w"> </span><span class="o">[</span>ARGS<span class="o">]</span>...

╭─<span class="w"> </span>Options<span class="w"> </span>───────────────────────────────────────────────────────────────────────────────────────────────────────╮
│<span class="w"> </span>--install-completion<span class="w">          </span>Install<span class="w"> </span>completion<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>current<span class="w"> </span>shell.<span class="w">                                         </span>│
│<span class="w"> </span>--show-completion<span class="w">             </span>Show<span class="w"> </span>completion<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>current<span class="w"> </span>shell,<span class="w"> </span>to<span class="w"> </span>copy<span class="w"> </span>it<span class="w"> </span>or<span class="w"> </span>customize<span class="w"> </span>the<span class="w"> </span>installation.<span class="w">  </span>│
│<span class="w"> </span>--help<span class="w">                        </span>Show<span class="w"> </span>this<span class="w"> </span>message<span class="w"> </span>and<span class="w"> </span>exit.<span class="w">                                                       </span>│
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─<span class="w"> </span>Commands<span class="w"> </span>──────────────────────────────────────────────────────────────────────────────────────────────────────╮
│<span class="w"> </span>clean<span class="w">               </span>Delete<span class="w"> </span>or<span class="w"> </span>soft-delete<span class="w"> </span>files<span class="w"> </span><span class="k">in</span><span class="w"> </span>an<span class="w"> </span>S3<span class="w"> </span>bucket<span class="w"> </span>that<span class="w"> </span>contain<span class="w"> </span>a<span class="w"> </span>specific<span class="w"> </span>substring<span class="w"> </span><span class="k">in</span><span class="w"> </span>their<span class="w">      </span>│
│<span class="w">                     </span>names.<span class="w">                                                                                      </span>│
│<span class="w"> </span>clear-soft-delete<span class="w">   </span>Remove<span class="w"> </span>all<span class="w"> </span>files<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>soft<span class="w"> </span>delete<span class="w"> </span>directory.<span class="w">                                              </span>│
│<span class="w"> </span>undo-soft-delete<span class="w">    </span>Restore<span class="w"> </span>all<span class="w"> </span>files<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>soft<span class="w"> </span>delete<span class="w"> </span>directory<span class="w"> </span>to<span class="w"> </span>their<span class="w"> </span>original<span class="w"> </span>locations.<span class="w">               </span>│
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯

⬢<span class="w"> </span><span class="o">[</span>devtainer<span class="o">]</span><span class="w"> </span>❯<span class="w"> </span>./scripts/s3_cleanup.py<span class="w"> </span>clean<span class="w"> </span>--help

<span class="w"> </span>Usage:<span class="w"> </span>s3_cleanup.py<span class="w"> </span>clean<span class="w"> </span><span class="o">[</span>OPTIONS<span class="o">]</span><span class="w"> </span>BUCKET_NAME<span class="w"> </span>SUBSTRING

<span class="w"> </span>Delete<span class="w"> </span>or<span class="w"> </span>soft-delete<span class="w"> </span>files<span class="w"> </span><span class="k">in</span><span class="w"> </span>an<span class="w"> </span>S3<span class="w"> </span>bucket<span class="w"> </span>that<span class="w"> </span>contain<span class="w"> </span>a<span class="w"> </span>specific<span class="w"> </span>substring<span class="w"> </span><span class="k">in</span><span class="w"> </span>their<span class="w"> </span>names.

╭─<span class="w"> </span>Arguments<span class="w"> </span>─────────────────────────────────────────────────────────────────────────────────────────────────────╮
│<span class="w"> </span>*<span class="w">    </span>bucket_name<span class="w">      </span>TEXT<span class="w">  </span>The<span class="w"> </span>name<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>S3<span class="w"> </span>bucket.<span class="w"> </span><span class="o">[</span>default:<span class="w"> </span>None<span class="o">]</span><span class="w"> </span><span class="o">[</span>required<span class="o">]</span><span class="w">                               </span>│
│<span class="w"> </span>*<span class="w">    </span>substring<span class="w">        </span>TEXT<span class="w">  </span>The<span class="w"> </span>substring<span class="w"> </span>to<span class="w"> </span>search<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>file<span class="w"> </span>names.<span class="w"> </span><span class="o">[</span>default:<span class="w"> </span>None<span class="o">]</span><span class="w"> </span><span class="o">[</span>required<span class="o">]</span><span class="w">               </span>│
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─<span class="w"> </span>Options<span class="w"> </span>───────────────────────────────────────────────────────────────────────────────────────────────────────╮
│<span class="w"> </span>--dry-run<span class="w">            </span>--no-dry-run<span class="w">                 </span>If<span class="w"> </span>set,<span class="w"> </span>no<span class="w"> </span>files<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>deleted<span class="p">;</span><span class="w"> </span>only<span class="w"> </span>listed.<span class="w">                </span>│
│<span class="w">                                                   </span><span class="o">[</span>default:<span class="w"> </span>no-dry-run<span class="o">]</span><span class="w">                                         </span>│
│<span class="w"> </span>--soft-delete<span class="w">        </span>--no-soft-delete<span class="w">             </span>If<span class="w"> </span>set,<span class="w"> </span>files<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>moved<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>soft<span class="w"> </span>delete<span class="w"> </span>directory<span class="w">        </span>│
│<span class="w">                                                   </span>instead<span class="w"> </span>of<span class="w"> </span>permanently<span class="w"> </span>deleted.<span class="w">                               </span>│
│<span class="w">                                                   </span><span class="o">[</span>default:<span class="w"> </span>no-soft-delete<span class="o">]</span><span class="w">                                     </span>│
│<span class="w"> </span>--soft-delete-dir<span class="w">                        </span>TEXT<span class="w">     </span>The<span class="w"> </span>directory<span class="w"> </span>to<span class="w"> </span>move<span class="w"> </span>soft-deleted<span class="w"> </span>files<span class="w"> </span>to.<span class="w">                  </span>│
│<span class="w">                                                   </span><span class="o">[</span>default:<span class="w"> </span>soft-delete/<span class="o">]</span><span class="w">                                       </span>│
│<span class="w"> </span>--max-age<span class="w">                                </span>INTEGER<span class="w">  </span>Maximum<span class="w"> </span>age<span class="w"> </span>of<span class="w"> </span>files<span class="w"> </span>to<span class="w"> </span>include,<span class="w"> </span><span class="k">in</span><span class="w"> </span>days.<span class="w"> </span><span class="o">[</span>default:<span class="w"> </span>None<span class="o">]</span><span class="w">     </span>│
│<span class="w"> </span>--min-age<span class="w">                                </span>INTEGER<span class="w">  </span>Minimum<span class="w"> </span>age<span class="w"> </span>of<span class="w"> </span>files<span class="w"> </span>to<span class="w"> </span>include,<span class="w"> </span><span class="k">in</span><span class="w"> </span>days.<span class="w"> </span><span class="o">[</span>default:<span class="w"> </span>None<span class="o">]</span><span class="w">     </span>│
│<span class="w"> </span>--help<span class="w">                                            </span>Show<span class="w"> </span>this<span class="w"> </span>message<span class="w"> </span>and<span class="w"> </span>exit.<span class="w">                                   </span>│
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯

⬢<span class="w"> </span><span class="o">[</span>devtainer<span class="o">]</span><span class="w"> </span>❯<span class="w"> </span>./scripts/s3_cleanup.py<span class="w"> </span>clear-soft-delete<span class="w"> </span>--help

<span class="w"> </span>Usage:<span class="w"> </span>s3_cleanup.py<span class="w"> </span>clear-soft-delete<span class="w"> </span><span class="o">[</span>OPTIONS<span class="o">]</span><span class="w"> </span>BUCKET_NAME

<span class="w"> </span>Remove<span class="w"> </span>all<span class="w"> </span>files<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>soft<span class="w"> </span>delete<span class="w"> </span>directory.

╭─<span class="w"> </span>Arguments<span class="w"> </span>─────────────────────────────────────────────────────────────────────────────────────────────────────╮
│<span class="w"> </span>*<span class="w">    </span>bucket_name<span class="w">      </span>TEXT<span class="w">  </span>The<span class="w"> </span>name<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>S3<span class="w"> </span>bucket.<span class="w"> </span><span class="o">[</span>default:<span class="w"> </span>None<span class="o">]</span><span class="w"> </span><span class="o">[</span>required<span class="o">]</span><span class="w">                               </span>│
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─<span class="w"> </span>Options<span class="w"> </span>───────────────────────────────────────────────────────────────────────────────────────────────────────╮
│<span class="w"> </span>--soft-delete-dir<span class="w">                    </span>TEXT<span class="w">  </span>The<span class="w"> </span>soft<span class="w"> </span>delete<span class="w"> </span>directory<span class="w"> </span>to<span class="w"> </span>clear.<span class="w"> </span><span class="o">[</span>default:<span class="w"> </span>soft-delete/<span class="o">]</span><span class="w">          </span>│
│<span class="w"> </span>--dry-run<span class="w">            </span>--no-dry-run<span class="w">          </span>If<span class="w"> </span>set,<span class="w"> </span>no<span class="w"> </span>files<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>deleted<span class="p">;</span><span class="w"> </span>only<span class="w"> </span>listed.<span class="w"> </span><span class="o">[</span>default:<span class="w"> </span>no-dry-run<span class="o">]</span><span class="w"> </span>│
│<span class="w"> </span>--help<span class="w">                                     </span>Show<span class="w"> </span>this<span class="w"> </span>message<span class="w"> </span>and<span class="w"> </span>exit.<span class="w">                                          </span>│
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯

⬢<span class="w"> </span><span class="o">[</span>devtainer<span class="o">]</span><span class="w"> </span>❯<span class="w"> </span>./scripts/s3_cleanup.py<span class="w"> </span>undo-soft-delete<span class="w"> </span>--help

<span class="w"> </span>Usage:<span class="w"> </span>s3_cleanup.py<span class="w"> </span>undo-soft-delete<span class="w"> </span><span class="o">[</span>OPTIONS<span class="o">]</span><span class="w"> </span>BUCKET_NAME

<span class="w"> </span>Restore<span class="w"> </span>all<span class="w"> </span>files<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>soft<span class="w"> </span>delete<span class="w"> </span>directory<span class="w"> </span>to<span class="w"> </span>their<span class="w"> </span>original<span class="w"> </span>locations.

╭─<span class="w"> </span>Arguments<span class="w"> </span>─────────────────────────────────────────────────────────────────────────────────────────────────────╮
│<span class="w"> </span>*<span class="w">    </span>bucket_name<span class="w">      </span>TEXT<span class="w">  </span>The<span class="w"> </span>name<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>S3<span class="w"> </span>bucket.<span class="w"> </span><span class="o">[</span>default:<span class="w"> </span>None<span class="o">]</span><span class="w"> </span><span class="o">[</span>required<span class="o">]</span><span class="w">                               </span>│
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─<span class="w"> </span>Options<span class="w"> </span>───────────────────────────────────────────────────────────────────────────────────────────────────────╮
│<span class="w"> </span>--soft-delete-dir<span class="w">                    </span>TEXT<span class="w">  </span>The<span class="w"> </span>soft<span class="w"> </span>delete<span class="w"> </span>directory<span class="w"> </span>to<span class="w"> </span>restore<span class="w"> </span>from.<span class="w"> </span><span class="o">[</span>default:<span class="w"> </span>soft-delete/<span class="o">]</span><span class="w">   </span>│
│<span class="w"> </span>--dry-run<span class="w">            </span>--no-dry-run<span class="w">          </span>If<span class="w"> </span>set,<span class="w"> </span>no<span class="w"> </span>files<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>restored<span class="p">;</span><span class="w"> </span>only<span class="w"> </span>listed.<span class="w">                      </span>│
│<span class="w">                                            </span><span class="o">[</span>default:<span class="w"> </span>no-dry-run<span class="o">]</span><span class="w">                                                </span>│
│<span class="w"> </span>--help<span class="w">                                     </span>Show<span class="w"> </span>this<span class="w"> </span>message<span class="w"> </span>and<span class="w"> </span>exit.<span class="w">                                          </span>│
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
</pre></div>

</pre>
</div>
</article>
<article>
<h2 class="m-auto max-w-md text-sm text-center text-gray-200 no-link">Recent Posts</h2>
<ul class="px-0">
<li class="px-4 mx-0 post group h-entry hentry list-none">
<a class="u-url" href="/wondercraft-session-one/" hx-boost="true" rel="bookmark">
<p class="p-0 m-0 p-name entry-title text-base group-hover:text-yellow-500 flex flex-row flex-wrap">
            Wondercraft Session One
            <time class="dt-published published font-normal pl-4 m-0 p-0 text-white/60 group-hover:text-white" datetime="2025-01-13">
                2025-1-13
            </time>
</p>
</a>
</li><li class="px-4 mx-0 post group h-entry hentry list-none">
<a class="u-url" href="/one-shot-s3-cleanup/" hx-boost="true" rel="bookmark">
<p class="p-0 m-0 p-name entry-title text-base group-hover:text-yellow-500 flex flex-row flex-wrap">
            One-Shot-S3-Cleanup
            <time class="dt-published published font-normal pl-4 m-0 p-0 text-white/60 group-hover:text-white" datetime="2025-01-12">
                2025-1-12
            </time>
</p>
</a>
</li><li class="px-4 mx-0 post group h-entry hentry list-none">
<a class="u-url" href="/nvim-manager/" hx-boost="true" rel="bookmark">
<p class="p-0 m-0 p-name entry-title text-base group-hover:text-yellow-500 flex flex-row flex-wrap">
            Nvim-Manager
            <time class="dt-published published font-normal pl-4 m-0 p-0 text-white/60 group-hover:text-white" datetime="2025-01-12">
                2025-1-12
            </time>
</p>
</a>
</li><li class="px-4 mx-0 post group h-entry hentry list-none">
<a class="u-url" href="/now/" hx-boost="true" rel="bookmark">
<p class="p-0 m-0 p-name entry-title text-base group-hover:text-yellow-500 flex flex-row flex-wrap">
            Now
            <time class="dt-published published font-normal pl-4 m-0 p-0 text-white/60 group-hover:text-white" datetime="2025-01-12">
                2025-1-12
            </time>
</p>
</a>
</li><li class="px-4 mx-0 post group h-entry hentry list-none">
<a class="u-url" href="/we-beat-trailmakers/" hx-boost="true" rel="bookmark">
<p class="p-0 m-0 p-name entry-title text-base group-hover:text-yellow-500 flex flex-row flex-wrap">
            We Beat Trailmakers
            <time class="dt-published published font-normal pl-4 m-0 p-0 text-white/60 group-hover:text-white" datetime="2025-01-10">
                2025-1-10
            </time>
</p>
</a>
</li><li class="px-4 mx-0 post group h-entry hentry list-none">
<a class="u-url" href="/postiz-file-upload/" hx-boost="true" rel="bookmark">
<p class="p-0 m-0 p-name entry-title text-base group-hover:text-yellow-500 flex flex-row flex-wrap">
            Postiz-File-Upload
            <time class="dt-published published font-normal pl-4 m-0 p-0 text-white/60 group-hover:text-white" datetime="2025-01-10">
                2025-1-10
            </time>
</p>
</a>
</li><li class="px-4 mx-0 post group h-entry hentry list-none">
<a class="u-url" href="/start/" hx-boost="true" rel="bookmark">
<p class="p-0 m-0 p-name entry-title text-base group-hover:text-yellow-500 flex flex-row flex-wrap">
            Start
            <time class="dt-published published font-normal pl-4 m-0 p-0 text-white/60 group-hover:text-white" datetime="2025-01-03">
                2025-1-3
            </time>
</p>
</a>
</li><li class="px-4 mx-0 post group h-entry hentry list-none">
<a class="u-url" href="/slow-nfs-performance/" hx-boost="true" rel="bookmark">
<p class="p-0 m-0 p-name entry-title text-base group-hover:text-yellow-500 flex flex-row flex-wrap">
            Slow Nfs Performance
            <time class="dt-published published font-normal pl-4 m-0 p-0 text-white/60 group-hover:text-white" datetime="2025-01-02">
                2025-1-2
            </time>
</p>
</a>
</li><li class="px-4 mx-0 post group h-entry hentry list-none">
<a class="u-url" href="/colophon/" hx-boost="true" rel="bookmark">
<p class="p-0 m-0 p-name entry-title text-base group-hover:text-yellow-500 flex flex-row flex-wrap">
            Colophon
            <time class="dt-published published font-normal pl-4 m-0 p-0 text-white/60 group-hover:text-white" datetime="2025-01-02">
                2025-1-2
            </time>
</p>
</a>
</li><li class="px-4 mx-0 post group h-entry hentry list-none">
<a class="u-url" href="/setting-up-ucore-zfs/" hx-boost="true" rel="bookmark">
<p class="p-0 m-0 p-name entry-title text-base group-hover:text-yellow-500 flex flex-row flex-wrap">
            Setting Up Ucore-Zfs
            <time class="dt-published published font-normal pl-4 m-0 p-0 text-white/60 group-hover:text-white" datetime="2024-12-27">
                2024-12-27
            </time>
</p>
</a>
</li></ul>
<h2 class="m-auto max-w-md text-sm text-center text-gray-200 no-link">Recent <a href="/thoughts/" hx-boost="true">Thoughts</a></h2>
<ul class="px-0">
<li class="px-4 mx-0 post group h-entry hentry list-none">
<a class="u-url" href="/thoughts-529/" hx-boost="true" rel="bookmark">
<p class="p-0 m-0 p-name entry-title text-base group-hover:text-yellow-500 flex flex-row flex-wrap">
            💭 Supermini Nrf52840 Wireless Controller Developme
            ...
            <time class="dt-published published font-normal pl-4 m-0 p-0 text-white/60 group-hover:text-white" datetime="2025-01-13">
                2025-1-13
            </time>
</p>
</a>
</li><li class="px-4 mx-0 post group h-entry hentry list-none">
<a class="u-url" href="/thoughts-530/" hx-boost="true" rel="bookmark">
<p class="p-0 m-0 p-name entry-title text-base group-hover:text-yellow-500 flex flex-row flex-wrap">
            💭 Availability
            <time class="dt-published published font-normal pl-4 m-0 p-0 text-white/60 group-hover:text-white" datetime="2025-01-13">
                2025-1-13
            </time>
</p>
</a>
</li><li class="px-4 mx-0 post group h-entry hentry list-none">
<a class="u-url" href="/thoughts-531/" hx-boost="true" rel="bookmark">
<p class="p-0 m-0 p-name entry-title text-base group-hover:text-yellow-500 flex flex-row flex-wrap">
            💭 Why I Write
            <time class="dt-published published font-normal pl-4 m-0 p-0 text-white/60 group-hover:text-white" datetime="2025-01-13">
                2025-1-13
            </time>
</p>
</a>
</li><li class="px-4 mx-0 post group h-entry hentry list-none">
<a class="u-url" href="/thoughts-532/" hx-boost="true" rel="bookmark">
<p class="p-0 m-0 p-name entry-title text-base group-hover:text-yellow-500 flex flex-row flex-wrap">
            💭 (110) The Future Of Htmx - Youtube
            <time class="dt-published published font-normal pl-4 m-0 p-0 text-white/60 group-hover:text-white" datetime="2025-01-13">
                2025-1-13
            </time>
</p>
</a>
</li><li class="px-4 mx-0 post group h-entry hentry list-none">
<a class="u-url" href="/thoughts-524/" hx-boost="true" rel="bookmark">
<p class="p-0 m-0 p-name entry-title text-base group-hover:text-yellow-500 flex flex-row flex-wrap">
            💭 (107) Why You Should Game On Linux (Feat. Glorio
            ...
            <time class="dt-published published font-normal pl-4 m-0 p-0 text-white/60 group-hover:text-white" datetime="2025-01-11">
                2025-1-11
            </time>
</p>
</a>
</li><li class="px-4 mx-0 post group h-entry hentry list-none">
<a class="u-url" href="/thoughts-526/" hx-boost="true" rel="bookmark">
<p class="p-0 m-0 p-name entry-title text-base group-hover:text-yellow-500 flex flex-row flex-wrap">
            💭 Bluesky Is More Like Twitter Than X Is
            <time class="dt-published published font-normal pl-4 m-0 p-0 text-white/60 group-hover:text-white" datetime="2025-01-11">
                2025-1-11
            </time>
</p>
</a>
</li><li class="px-4 mx-0 post group h-entry hentry list-none">
<a class="u-url" href="/thoughts-527/" hx-boost="true" rel="bookmark">
<p class="p-0 m-0 p-name entry-title text-base group-hover:text-yellow-500 flex flex-row flex-wrap">
            💭 Quick Start - Kotaemon Docs
            <time class="dt-published published font-normal pl-4 m-0 p-0 text-white/60 group-hover:text-white" datetime="2025-01-11">
                2025-1-11
            </time>
</p>
</a>
</li><li class="px-4 mx-0 post group h-entry hentry list-none">
<a class="u-url" href="/thoughts-523/" hx-boost="true" rel="bookmark">
<p class="p-0 m-0 p-name entry-title text-base group-hover:text-yellow-500 flex flex-row flex-wrap">
            💭 V2 Suddenly Getting Client-Not-Enrolled Today - 
            ...
            <time class="dt-published published font-normal pl-4 m-0 p-0 text-white/60 group-hover:text-white" datetime="2025-01-10">
                2025-1-10
            </time>
</p>
</a>
</li><li class="px-4 mx-0 post group h-entry hentry list-none">
<a class="u-url" href="/thoughts-515/" hx-boost="true" rel="bookmark">
<p class="p-0 m-0 p-name entry-title text-base group-hover:text-yellow-500 flex flex-row flex-wrap">
            💭 Olimorris/Codecompanion.Nvim: ✨ Ai-Powered Codin
            ...
            <time class="dt-published published font-normal pl-4 m-0 p-0 text-white/60 group-hover:text-white" datetime="2025-01-09">
                2025-1-9
            </time>
</p>
</a>
</li><li class="px-4 mx-0 post group h-entry hentry list-none">
<a class="u-url" href="/thoughts-516/" hx-boost="true" rel="bookmark">
<p class="p-0 m-0 p-name entry-title text-base group-hover:text-yellow-500 flex flex-row flex-wrap">
            💭 Gitingest
            <time class="dt-published published font-normal pl-4 m-0 p-0 text-white/60 group-hover:text-white" datetime="2025-01-09">
                2025-1-9
            </time>
</p>
</a>
</li></ul>
<h2 class="m-auto max-w-md text-sm text-center text-gray-200 no-link">Recent Posts from People I read</h2>
<div hx-get="https://reader.waylonwlker.com/10-written" hx-swap="outerHTML" hx-trigger="load"></div>
<h2 class="m-auto max-w-md text-sm text-center text-gray-200 no-link">Recent Posts from my YouTube subs</h2>
<div hx-get="https://reader.waylonwlker.com/10-video" hx-swap="outerHTML" hx-trigger="load"></div>
<h2 class="m-auto max-w-md text-sm text-center text-gray-200 no-link">Recent Posts from my favorite pods</h2>
<div hx-get="https://reader.waylonwlker.com/10-video" hx-swap="outerHTML" hx-trigger="load"></div> </article>
</div>
<footer class="bg-gray-900 border-t border-pink-800 pb-8">
<ul class="social my-8">
<li>
<a class="decoration-pink-500 hover:decoration-pink-300 hover:text-pink-100" href="https://waylonwalker.com/feeds" hx-boost="true" rel="me">RSS</a>
</li>
<li>
<a class="decoration-pink-500 hover:decoration-pink-300 hover:text-pink-100" href="https://twitter.com/_WaylonWalker" rel="me">twitter</a>
</li>
<li>
<a class="decoration-pink-500 hover:decoration-pink-300 hover:text-pink-100" href="https://youtube.com/waylonwalker">youtube</a>
</li>
<li>
<a class="decoration-pink-500 hover:decoration-pink-300 hover:text-pink-100" href="https://www.youtube.com/channel/UCHuxc1HRsd3aRjvL6C817tQ">gaming-youtube</a>
</li>
<li>
<a class="decoration-pink-500 hover:decoration-pink-300 hover:text-pink-100" href="https://www.linkedin.com/in/waylonwalker/">LinkedIn</a>
</li>
<li>
<a class="decoration-pink-500 hover:decoration-pink-300 hover:text-pink-100" href="https://github.com/WaylonWalker" rel="me">GitHub</a>
</li>
<li>
<a class="decoration-pink-500 hover:decoration-pink-300 hover:text-pink-100" href="https://dev.to/waylonwalker">Dev.to</a>
</li>
<li>
<a class="decoration-pink-500 hover:decoration-pink-300 hover:text-pink-100" href="https://www.twitch.tv/waylonwalker">twitch</a>
</li>
<li>
<a class="decoration-pink-500 hover:decoration-pink-300 hover:text-pink-100" href="mailto:hello@waylonwalker.com" rel="me">hello@waylonwalker.com</a>
</li>
</ul>
<p>© 2025</p>
</footer> </div>
</body>
</html>